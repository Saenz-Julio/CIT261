<!DOCTYPE html>
<html>

	<head>
	
		<style>
			body {
			  background-color: lightblue;			  
			  margin: auto;
 			  width: 95%; 			  
			}			
			h1 {
			  background-color: black;
			  text-align: center;
			  text-transform: uppercase;
			  color: white;			  
			}
			p {
			  text-align: justify;
			  letter-spacing: 1px;
			}
			a {
			  text-decoration: none;
			  color: #008CBA;
			}
			canvas {
			  background-color: white;
			}
			input {
				background-color: white;
			}
			input:hover {
			  background-color: black;
			  color: white;
			}
			#recommendation {
			  background-color: lightblue;
			}
			#recommendation:hover {
			  background-color: white;				 	  
			}
			#animate {
			  width: 450px;
			  height: 100px;
			  position: absolute;
			  background-color: lightblue;
			}
		</style>
		
	</head>
	
	<body id="body">
		
		<h1>CIT 261: Water Calc App - Julio Saenz</h1>
		<p>This program covers the following: JavaScript, JavaScript Objects, JSON, AJAX, Local Storage, DOM, HTML5 Tags, and CSS Manipulation, Events, Animations, Transoform, and Transition.</p>
		
		<div id="input">
			<p><b>Please enter the values below to calculate the amount of water you should drink on a daily basis.</b></p>	
			Enter your age: <input type="number" id="age" onclick="this.value = '' "/>
			Weight(pounds): <input type="number" id="wei" onclick="this.value = '' "/>
			Height(inches): <input type="number" id="hei" onclick="this.value = '' "/>
			Water consummed today(ounces): <input type="number" id="wat" onclick="this.value = '' "/>		
			<button onclick="calculate()">Calculate</button>
			<button onclick="reset()">Reset</button>	
			<p><b>Results:</b></p>			
		</div>
		
		<div id="recommendation">				
			<p id="calc">-</p>				
			<p id="temp">-</p>	
			<p id="comp">-</p>				
		</div>
		
		<div id="canvas">				
			<p><b>Your Current Progress:</b></p>		
			<div id ="animate"></div>				
			<canvas id="myCanvas" width="400" height="100" style="border:none;">
			Your browser does not support the HTML5 canvas tag.
			</canvas>	
		</div>	
		
		<p><b>Calculation history:</b></p>	
		<ul id="history"></ul>		
		
		<div id="video">
			<p><b>Below is a safety tip about keeping drinking water clean:</b></p>
			<p>Video courtesy of <a href="https://www.health.govt.nz/our-work/environmental-health/drinking-water/drinking-water-resources/drinking-water-videos" target="_blank">Health.gov</a>.</p>
			<video id="v1" width="530" controls>
			  <source src="water-bugs-1.mp4" type="video/mp4">
			  Your browser does not support HTML5 video.
			</video>				
		</div>		
		
		<div id="audio">
			<p><b>Below is a swiming tip for kids:</b></p>
			<p>Video courtesy of <a href="http://www.sligococo.ie/Environment/Water/WaterSafety/" target="_blank">Sligo</a>.</p>
			<audio controls>
				<source src="drownmonthly.mp3" type="audio/mpeg">
				Your browser does not support the audio element.
			</audio>
		</div>		
		
		<script>		
			// Creates an empty array to take in values from local storage
			var array = [];				
			var associativeArray = [];	
			var city = "Texas";
			
			// Pulls JSON from openwathermap.org API via AJAX call
			var weather = new XMLHttpRequest();
			weather.open("GET", "http://api.openweathermap.org/data/2.5/weather?q=" + city + "&units=imperial&APPID=311323dccd32343d1ef03de7a7f5777e", 'true');
			weather.send();			
					
			function calculate() {					
				// Parses JSON code retrieved from openwathermap.org
				var res = weather.response;
				var obj = JSON.parse(res);
				var tem = obj.main.temp;
				var hum = obj.main.humidity;	
				var nam = obj.name;	
					
				// Sets value in local storage
				if (typeof(Storage) !== "undefined") {
					localStorage.setItem("localTem", tem);
					localStorage.setItem("localHum", hum);
					localStorage.setItem("localNam", nam);
				} else {
				  	document.getElementById("result").innerHTML = "Sorry, your browser does not support Web Storage...";
				}
				// Pushes local storage values to associative array.
			    associativeArray["tem"] = localStorage.getItem("localTem");    
			    associativeArray["hum"] = localStorage.getItem("localHum");  
			    associativeArray["nam"] = localStorage.getItem("localNam");  	
				
				// Gets user entered values
				var age = document.getElementById('age').value;
				var wei = document.getElementById('wei').value;
				var hei = document.getElementById('hei').value;
				var wat = document.getElementById('wat').value;
				
				// Create an object from entered values
				var item = new calc(age, wei, hei, wat);
				
				// Creates new list element and appends values from array and object.
				var line = document.createElement("LI");
			    var node = document.createTextNode(
			    	// gets values from associative array
			    	"Current Temperature: " + associativeArray["tem"] + "  " + 
			    	"humidity = " + associativeArray["hum"] + ", " +
			    	"city name = " + associativeArray["nam"] + ", " +
			    	// gets values from object
			    	"age = " + item.age + ", " +
			    	"weight = " + item.wei + ", " +
			    	"height = " + item.hei + ", " +
			    	"water dranked = " + item.wat);
			    line.appendChild(node);
			    document.getElementById("history").appendChild(line);			    
			   	    
			    // Calculates and displays water amounts
			    var calcBase = Number(calcWater(item.age, item.wei, item.hei));
			    var calcExtr = Number(calcExtra(associativeArray["tem"]) * calcBase);
			    var calcTota = calcBase + calcExtr;
			 	var calcComp = Number(calcCompare(calcBase, item.wat).toFixed(0));
			 	var calcPerc;
			 				 				    
			    document.getElementById("calc").innerHTML = calcBase + " ounces (Recommended amount of water per day--------)";
			    document.getElementById("temp").innerHTML = calcExtr + " ounces (Additional amount to drink based on the current temperature of " + associativeArray["tem"] + "&deg F in " + associativeArray["nam"] + ")";
			    
			    if (calcComp <= 0) {
			    	document.getElementById("comp").innerHTML = calcComp * -1 + " ounces (Additional amount to drink based on " + wat + " ounces already consummed)";
			    	calcPerc = (1 - (calcComp / calcTota * -1)) * 400;
			    } else {
			    	document.getElementById("comp").innerHTML = "0 ounces (Additional amount to drink based on " + wat + " ounces already consummed)";
			    	calcPerc = 100 * 4;
			    }
			    
			    // Canvas: variables
			    var c = document.getElementById("myCanvas");
			    var ctx = c.getContext("2d");
			    var ctx2 = c.getContext("2d");

			    // Canvas: Create gradient
			    var grd = ctx.createLinearGradient(0,0,400,0);
			    grd.addColorStop(0,"red");
			    grd.addColorStop(1,"white");

			    // Canvas: Fill with gradient
			    ctx.fillStyle = grd;
			    ctx.clearRect(0, 0, 400, 100)
			    ctx.fillRect(0,0,calcPerc,100);			    
			    ctx.font = "30px Arial";
			    ctx2.fillStyle = "black";
			    ctx2.textAlign = "center";
			    ctx2.fillText(Number(calcPerc / 4).toFixed(0) + "%",200,60);
			    
			 	// Element transition via triggered CSS
			    document.getElementById("recommendation").style.transition = "all 5s";
			 	
			 	// Element transform via triggered CSS
			    document.getElementById("recommendation").style.transform = "translate(10px)"; 
			    
			    // Canvas animation via triggered CSS
			    var elem = document.getElementById("animate");   
				var pos = 0;
			  	var id = setInterval(frame, 6);
			  	function frame() {
				    if (pos == 450) {
				      clearInterval(id);
				    } else {
				      pos++; 
				      elem.style.left = pos + "px"; 
				      elem.style.right = pos + "px"; 
				    }
		    	}	
			}
			
			// calculates the amount of water that should be consumed per day
			function calcWater(age, wei, hei) {
		 		var ageMultiplier;	
		 		var heiMultiplier;	
		 		var waterAmount;
		 		
		  		switch (true) {
			  	case age >= 55:
			  		ageMultiplier = 30;
			    	break;
			  	case age >= 30:
			  		ageMultiplier = 35;
			   		break;
			  	case age >= 1:
			  		ageMultiplier = 40;
			   		break;
				}	
		  		
		  		switch (true) {
			  	case hei >= 78:
			  		heiMultiplier = 1.1;
			    	break;
			  	case hei >= 68:
			  		heiMultiplier = 1.05;
			   		break;
			  	case hei >= 1:				  		
			  		heiMultiplier = 1;
			   		break;
				}	
		  
		  		waterAmount = wei /2.2 * ageMultiplier / 28.3 * heiMultiplier;
		  		return waterAmount.toFixed(0);
		  	}	
			
			// calculates the amount of water that should be consumed per day
		  	function calcExtra(tem) {
		 		var temMultiplier;			 		
		  		
		  		switch (true) {
		  		case tem >= 100:
			  		temMultiplier = .3;
		  			document.getElementById("temp").style.backgroundColor = "red";
			    	break;
		  		case tem >= 90:
			  		temMultiplier = .2;
		  			document.getElementById("temp").style.backgroundColor = "orange";
			    	break;
			  	case tem >= 80:
			  		temMultiplier = .1;
			  		document.getElementById("temp").style.backgroundColor = "yellow";
			   		break;
			  	case tem >= 1:				  		
			  		temMultiplier = 0;				  		
			   		break;
				}	
		  		return temMultiplier.toFixed(0);
		  	}	
			
		 	// calculates the difference between the amount recommended vs. amount dranked
		  	function calcCompare(calcTota, wat) {			 			
		  		return wat - calcTota;
		  	}
			
			// Create an object
			function calc(age, wei, hei, wat) {
			  	this.age = age;
			  	this.wei = wei;
			  	this.hei = hei;
			  	this.wat = wat;
			}
			
			// Clears all nodes in paragraph elements
			function reset() {
				var list = document.getElementById("calc");
				while (list.hasChildNodes()){
					list.removeChild(list.firstChild);
				}			
				var list = document.getElementById("temp");
				while (list.hasChildNodes()){
					list.removeChild(list.firstChild);
				}
				var list = document.getElementById("comp");
				while (list.hasChildNodes()){
					list.removeChild(list.firstChild);
				}	
			}	
		
		</script>
		
	</body>
	
</html>
